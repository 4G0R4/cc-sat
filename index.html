<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stacker News Cowboy Credits VS Bitcoin Satoshi Market Depth</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #1c1c1c;
            color: #fafafa;
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #404040;
        }
        .header h1 { 
            font-size: 1.75rem; 
            color: #fada3e;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .header p { 
            color: #a0a0a0; 
            font-size: 0.95rem;
        }
        .chart-container {
            background: #232323;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid #404040;
        }
        .chart-wrapper { position: relative; height: 400px; }
        .order-table-container {
            background: #232323;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid #404040;
            overflow-x: auto;
        }
        .order-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        .order-table th {
            color: #a0a0a0;
            font-weight: 600;
            padding: 12px;
            border-bottom: 2px solid #404040;
            text-align: center;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        .order-table td {
            padding: 10px 12px;
            text-align: center;
            border-bottom: 1px solid #404040;
        }
        .order-table tr:last-child td {
            border-bottom: none;
        }
        .order-table tr:hover {
            background: #2a2a2a;
        }
        .buy-cell {
            color: #4caf50;
            font-weight: 500;
        }
        .sell-cell {
            color: #f44336;
            font-weight: 500;
        }
        .price-cell {
            color: #fada3e;
            font-weight: 600;
            font-size: 1rem;
        }
        .order-table a {
            color: inherit;
            text-decoration: none;
        }
        .order-table a:hover {
            text-decoration: underline;
        }
        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .order-book {
            background: #232323;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #404040;
        }
        .order-book h3 { 
            font-size: 1rem; 
            margin-bottom: 16px;
            font-weight: 600;
            color: #fafafa;
        }
        .buy-orders h3::before { content: "ðŸ“ˆ "; }
        .sell-orders h3::before { content: "ðŸ“‰ "; }
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-size: 0.9rem;
            border-bottom: 1px solid #404040;
        }
        .order-item:last-child { border-bottom: none; }
        .order-user { 
            color: #fada3e;
            text-decoration: none;
            font-weight: 500;
        }
        .order-user:hover { 
            color: #ffd54f;
            text-decoration: underline;
        }
        .order-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .order-details { 
            color: #c0c0c0;
            font-size: 0.85rem;
        }
        .source-link {
            color: #fada3e;
            text-decoration: none;
            font-size: 1rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .source-link:hover { 
            opacity: 1;
        }
        .stats-container {
            background: #232323;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #404040;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            text-align: center;
        }
        .stat-item p:first-child {
            color: #a0a0a0;
            font-size: 0.8rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .stat-item p:last-child { 
            font-size: 1.5rem; 
            font-weight: 600;
        }
        .stat-bid { color: #4caf50; }
        .stat-spread { color: #fada3e; }
        .stat-ask { color: #f44336; }
        .stat-price { color: #fada3e; }
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; gap: 16px; }
            .orders-grid { grid-template-columns: 1fr; }
        }

        footer {
            margin: 1rem;
            padding: 1rem;
            color: #787878;
            text-align: center;
        }

        .header a,
        footer a {
            color: #bbbbbb;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ Stacker.News CC/SAT Exchange Order Book </h1>
            <p>Order book for CC/sats trading on Stacker News - <a href="https://stacker.news/items/1329607/r/AGORA" target="_blank">Place your order</a>.</p>
        </div>

        <div class="chart-container">
            <div class="chart-wrapper">
                <canvas id="depthChart"></canvas>
            </div>
        </div>

        <div class="stats-container">
            <div class="stats-grid">
                <div class="stat-item">
                    <p>Best Bid</p>
                    <p class="stat-bid" id="bestBid">-</p>
                </div>
                <div class="stat-item">
                    <p>Actual Price</p>
                    <p class="stat-price" id="actualPrice">-</p>
                </div>
                <div class="stat-item">
                    <p>Best Ask</p>
                    <p class="stat-ask" id="bestAsk">-</p>
                </div>
                <div class="stat-item">
                    <p>Spread</p>
                    <p class="stat-spread" id="spread">-</p>
                </div>
            </div>
        </div>

        <div class="orders-grid">
            <div class="order-book buy-orders">
                <h3>Buy Orders (Bids)</h3>
                <div id="buyOrdersList"></div>
            </div>

            <div class="order-book sell-orders">
                <h3>Sell Orders (Asks)</h3>
                <div id="sellOrdersList"></div>
            </div>
        </div>

        <div class="order-table-container">
            <table class="order-table">
                <thead>
                    <tr>
                        <th>Buy (CC)</th>
                        <th>Price (SATS)</th>
                        <th>Sell (CC)</th>
                    </tr>
                </thead>
                <tbody id="orderTableBody">
                </tbody>
            </table>
        </div>

        <footer>
            <p><small>âš¡ Stacker.News Cowboy Credits VS Bitcoin Satoshi Exchange Order Book 
                - <a href="https://github.com/4G0R4/cc-sat" target="_blank">Repository</a> 
                - <a href="https://github.com/4G0R4/cc-sat/issues/new" target="_blank">Open a issue</a> 
                - <a href="https://stacker.news/items/1329607/r/AGORA" target="_blank">Place your order</a>
            </small></p>
        </footer>
    </div>

    <script>
        var orders = [
            { user: '@Darthcoin', type: 'buy', cc: 1, sats: 1, postId: '723069' },
            { user: '@Darthcoin', type: 'sell', cc: 1, sats: 1, postId: '723069' },
            { user: '@SimpleStacker', type: 'buy', cc: 3, sats: 1.5, postId: '1323628' },
            { user: '@thebullishbitcoiner', type: 'sell', cc: 2, sats: 1, postId: '1323521' },
            { user: '@AGORA', type: 'buy', cc: 2, sats: 1.5, postId: '1323640' },
            { user: '@Undisciplined', type: 'buy', cc: 3, sats: 2, postId: '1323693' },
            { user: '@0xbitcoiner', type: 'buy', cc: 1, sats: 0.6, postId: '1323656' },
            { user: '@nokness', type: 'sell', cc: 19, sats: 16, postId: '944888' },
            { user: '@ek', type: 'buy', cc: 100, sats: 1, postId: '837469' }            
        ];

        for (var i = 0; i < orders.length; i++) {
            orders[i].rate = orders[i].sats / orders[i].cc;
        }

        var buyOrders = [];
        var sellOrders = [];
        
        for (var i = 0; i < orders.length; i++) {
            if (orders[i].type === 'buy') {
                buyOrders.push(orders[i]);
            } else {
                sellOrders.push(orders[i]);
            }
        }
        
        buyOrders.sort(function(a, b) { return b.rate - a.rate; });
        sellOrders.sort(function(a, b) { return a.rate - b.rate; });

        var buyDepth = [];
        var cumulativeBuyCC = 0;
        for (var i = 0; i < buyOrders.length; i++) {
            cumulativeBuyCC += buyOrders[i].cc;
            buyDepth.push({ price: buyOrders[i].rate, volume: cumulativeBuyCC });
        }

        var sellDepth = [];
        var cumulativeSellCC = 0;
        for (var j = 0; j < sellOrders.length; j++) {
            cumulativeSellCC += sellOrders[j].cc;
            sellDepth.push({ price: sellOrders[j].rate, volume: cumulativeSellCC });
        }

        var buyLabels = [];
        var buyVolumes = [];
        for (var k = 0; k < buyDepth.length; k++) {
            buyLabels.push(buyDepth[k].price.toFixed(4));
            buyVolumes.push(buyDepth[k].volume);
        }
        buyLabels.reverse();
        buyVolumes.reverse();
        
        var sellLabels = [];
        var sellVolumes = [];
        for (var m = 0; m < sellDepth.length; m++) {
            sellLabels.push(sellDepth[m].price.toFixed(4));
            sellVolumes.push(sellDepth[m].volume);
        }

        var allLabels = buyLabels.concat(sellLabels);
        var buyData = buyVolumes.slice();
        var sellData = [];
        
        for (var n = 0; n < buyVolumes.length; n++) {
            sellData.push(null);
        }
        for (var p = 0; p < sellVolumes.length; p++) {
            buyData.push(null);
            sellData.push(sellVolumes[p]);
        }

        var ctx = document.getElementById('depthChart').getContext('2d');
        
        var actualPrice = null;
        if (buyOrders.length > 0 && sellOrders.length > 0) {
            actualPrice = (buyOrders[0].rate + sellOrders[0].rate) / 2;
        }
        
        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: allLabels,
                datasets: [{
                    label: 'Buy Orders',
                    data: buyData,
                    borderColor: '#4caf50',
                    backgroundColor: 'rgba(76, 175, 80, 0.2)',
                    fill: true,
                    stepped: 'after',
                    borderWidth: 2
                }, {
                    label: 'Sell Orders',
                    data: sellData,
                    borderColor: '#f44336',
                    backgroundColor: 'rgba(244, 67, 54, 0.2)',
                    fill: true,
                    stepped: 'before',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { 
                        labels: { 
                            color: '#fafafa',
                            font: { size: 12 }
                        } 
                    },
                    tooltip: {
                        backgroundColor: 'rgba(35, 35, 35, 0.95)',
                        titleColor: '#fafafa',
                        bodyColor: '#c0c0c0',
                        borderColor: '#404040',
                        borderWidth: 1,
                        callbacks: {
                            label: function(context) {
                                var label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y.toLocaleString() + ' CC';
                                }
                                return label;
                            }
                        }
                    },
                    annotation: actualPrice ? {
                        annotations: {
                            line1: {
                                type: 'line',
                                xMin: actualPrice.toFixed(4),
                                xMax: actualPrice.toFixed(4),
                                borderColor: '#fada3e',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                label: {
                                    display: true,
                                    content: 'Actual Price',
                                    position: 'start',
                                    backgroundColor: '#fada3e',
                                    color: '#1c1c1c'
                                }
                            }
                        }
                    } : {}
                },
                scales: {
                    x: {
                        title: { 
                            display: true, 
                            text: 'Price (sats/CC)', 
                            color: '#a0a0a0',
                            font: { size: 12 }
                        },
                        ticks: { 
                            color: '#a0a0a0',
                            font: { size: 11 }
                        },
                        grid: { color: '#404040' }
                    },
                    y: {
                        title: { 
                            display: true, 
                            text: 'Cumulative Volume (CC)', 
                            color: '#a0a0a0',
                            font: { size: 12 }
                        },
                        ticks: {
                            color: '#a0a0a0',
                            font: { size: 11 },
                            callback: function(value) {
                                return value >= 1000000 ? (value / 1000000).toFixed(1) + 'M' : value.toLocaleString();
                            }
                        },
                        grid: { color: '#404040' }
                    }
                }
            }
        });

        var buyOrdersList = document.getElementById('buyOrdersList');
        for (var q = 0; q < buyOrders.length; q++) {
            var div = document.createElement('div');
            div.className = 'order-item';
            var userLink = document.createElement('a');
            userLink.className = 'order-user';
            userLink.href = 'https://stacker.news/' + buyOrders[q].user.substring(1);
            userLink.target = '_blank';
            userLink.textContent = buyOrders[q].user;
            
            var rightDiv = document.createElement('div');
            rightDiv.className = 'order-right';
            
            var detailsSpan = document.createElement('span');
            detailsSpan.className = 'order-details';
            detailsSpan.textContent = buyOrders[q].cc.toLocaleString() + ' CC : ' + buyOrders[q].sats.toLocaleString() + ' sats @' + buyOrders[q].rate.toFixed(4);
            rightDiv.appendChild(detailsSpan);
            
            if (buyOrders[q].postId) {
                var sourceLink = document.createElement('a');
                sourceLink.className = 'source-link';
                sourceLink.href = 'https://stacker.news/items/' + buyOrders[q].postId + '/r/' + buyOrders[q].user.substring(1);
                sourceLink.target = '_blank';
                sourceLink.textContent = 'ðŸ”—';
                rightDiv.appendChild(sourceLink);
            }
            
            div.appendChild(userLink);
            div.appendChild(rightDiv);
            buyOrdersList.appendChild(div);
        }

        var sellOrdersList = document.getElementById('sellOrdersList');
        for (var r = 0; r < sellOrders.length; r++) {
            var div2 = document.createElement('div');
            div2.className = 'order-item';
            var userLink2 = document.createElement('a');
            userLink2.className = 'order-user';
            userLink2.href = 'https://stacker.news/' + sellOrders[r].user.substring(1);
            userLink2.target = '_blank';
            userLink2.textContent = sellOrders[r].user;
            
            var rightDiv2 = document.createElement('div');
            rightDiv2.className = 'order-right';
            
            var detailsSpan2 = document.createElement('span');
            detailsSpan2.className = 'order-details';
            detailsSpan2.textContent = sellOrders[r].cc.toLocaleString() + ' CC : ' + sellOrders[r].sats.toLocaleString() + ' sats @' + sellOrders[r].rate.toFixed(4);
            rightDiv2.appendChild(detailsSpan2);
            
            if (sellOrders[r].postId) {
                var sourceLink2 = document.createElement('a');
                sourceLink2.className = 'source-link';
                sourceLink2.href = 'https://stacker.news/items/' + sellOrders[r].postId + '/r/' + sellOrders[r].user.substring(1);
                sourceLink2.target = '_blank';
                sourceLink2.textContent = 'ðŸ”—';
                rightDiv2.appendChild(sourceLink2);
            }
            
            div2.appendChild(userLink2);
            div2.appendChild(rightDiv2);
            sellOrdersList.appendChild(div2);
        }

        if (buyOrders.length > 0) {
            document.getElementById('bestBid').textContent = buyOrders[0].rate.toFixed(4) + ' sats/CC';
        } else {
            document.getElementById('bestBid').textContent = 'N/A';
        }
        
        if (sellOrders.length > 0) {
            document.getElementById('bestAsk').textContent = sellOrders[0].rate.toFixed(4) + ' sats/CC';
        } else {
            document.getElementById('bestAsk').textContent = 'N/A';
        }
        
        if (actualPrice) {
            document.getElementById('actualPrice').textContent = actualPrice.toFixed(4) + ' sats/CC';
        } else {
            document.getElementById('actualPrice').textContent = 'N/A';
        }
        
        var spreadText = 'N/A';
        if (sellOrders.length > 0 && buyOrders.length > 0) {
            var spreadValue =  buyOrders[0].rate - sellOrders[0].rate;
            var spreadPercent = ((spreadValue / buyOrders[0].rate) * 100).toFixed(2);
            spreadText = spreadValue.toFixed(4) + ' (' + spreadPercent + '%)';
        }
        document.getElementById('spread').textContent = spreadText;

        var allPrices = {};
        for (var i = 0; i < buyOrders.length; i++) {
            var price = buyOrders[i].rate.toFixed(2);
            if (!allPrices[price]) {
                allPrices[price] = { buy: [], sell: [] };
            }
            allPrices[price].buy.push(buyOrders[i]);
        }
        for (var j = 0; j < sellOrders.length; j++) {
            var price = sellOrders[j].rate.toFixed(2);
            if (!allPrices[price]) {
                allPrices[price] = { buy: [], sell: [] };
            }
            allPrices[price].sell.push(sellOrders[j]);
        }

        var priceKeys = Object.keys(allPrices).map(parseFloat).sort(function(a, b) { return b - a; });
        
        var orderTableBody = document.getElementById('orderTableBody');
        for (var k = 0; k < priceKeys.length; k++) {
            var priceKey = priceKeys[k].toFixed(2);
            var orders = allPrices[priceKey];
            
            var row = document.createElement('tr');
            
            var buyCell = document.createElement('td');
            buyCell.className = 'buy-cell';
            if (orders.buy.length > 0) {
                var buyTotal = 0;
                for (var m = 0; m < orders.buy.length; m++) {
                    buyTotal += orders.buy[m].cc;
                }
                var buyLink = document.createElement('a');
                buyLink.href = 'https://stacker.news/' + orders.buy[0].user.substring(1);
                buyLink.target = '_blank';
                buyLink.textContent = buyTotal.toLocaleString();
                buyCell.appendChild(buyLink);
            }
            row.appendChild(buyCell);
            
            var priceCell = document.createElement('td');
            priceCell.className = 'price-cell';
            priceCell.textContent = priceKey;
            row.appendChild(priceCell);
            
            var sellCell = document.createElement('td');
            sellCell.className = 'sell-cell';
            if (orders.sell.length > 0) {
                var sellTotal = 0;
                for (var n = 0; n < orders.sell.length; n++) {
                    sellTotal += orders.sell[n].cc;
                }
                var sellLink = document.createElement('a');
                sellLink.href = 'https://stacker.news/' + orders.sell[0].user.substring(1);
                sellLink.target = '_blank';
                sellLink.textContent = sellTotal.toLocaleString();
                sellCell.appendChild(sellLink);
            }
            row.appendChild(sellCell);
            
            orderTableBody.appendChild(row);
        }
    </script>
</body>
</html>
